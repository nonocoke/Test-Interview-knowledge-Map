接口限流

    * 限制每个调用方对公共服务平台总的接口请求频率
    * 对单独某个接口的访问频率进行限制

接口 -> 限流框架 -> 服务

限流框架(需求)
* 功能性需求
    * 配置限流规则
    * 提供编程接口（RateLimiter 类）验证请求是否被限流
* 非功能性需求
    * 框架的易用性 
        1. 希望限流规则的配置、编程接口的使用都很简单
        2. 提供各种不同的限流算法，比如基于内存的单机限流算法、基于 Redis 的分布式限流算法
        3. 被方便地集成
    * 扩展性、灵活性
        1. 能够灵活地扩展各种限流算法
        2. 支持不同格式（JSON、YAML、XML 等格式）
        3. 不同数据源（本地文件配置或 Zookeeper 集中配置等）的限流规则的配置方式
    * 性能
        1. 要让限流框架尽可能低延迟
        2. 尽可能减少对接口请求本身响应时间的影响
    * 容错性等
        1. 接入限流框架是为了提高系统的可用性、稳定性，不能因为限流框架的异常，反过来影响到服务本身的可用性

设计

(看如何通过合理的设计，实现一个满足易用、易扩展、灵活、低延时、高容错等非功能性需求的限流框架)

    * 限流规则
    * 限流算法 - 为了提高框架的易用性、灵活性，我们最好将其他几种常用的限流算法，也在框架中实现出来，供框架用户根据自己业务场景自由选择
        1. 固定时间窗口限流算法
        2. 滑动时间窗口限流算法
        3. 令牌桶限流算法
        4. 漏桶限流算法
    * 限流模式  -
               - 单机限流和分布式限流的主要区别在接口访问计数器的实现
        1. 单机限流
        2. 分布式限流
    * 集成使用
        1. 低侵入松耦合设计思想

接口幂等

接口调用的这个场景里，幂等的意思是，针对同一个接口，多次发起同一个业务请求，必须保证业务只执行一次

同一业务请求一个唯一标识，也就是“幂等号”！如果两个接口请求，带有相同的幂等号，那我们就判断它们是重试关系，是同一个业务请求，不要重复执行

功能性需求
```text
接口调用方生成幂等号，并且跟随接口请求，将幂等号传递给接口实现方。
    -> 接口实现方接收到接口请求之后，按照约定，从 HTTP Header 或者接口参数中，解析出幂等号，
    -> 然后通过幂等号查询幂等框架。
        -> 如果幂等号已经存在，说明业务已经执行或正在执行，则直接返回；
        -> 如果幂等号不存在，说明业务没有执行过，则记录幂等号，继续执行业务
```
非功能性需求

* 易用性
    * 框架接入简单方便，学习成本低。只需编写简单的配置以及少许代码，就能完成接入
    * 对业务代码低侵入松耦合，在统一的地方接入幂等框架
* 性能
    * 针对每个幂等接口，在正式处理业务逻辑之前，我们都要添加保证幂等的处理逻辑
    * 对于响应时间比较敏感的接口服务来说，我们要让幂等框架尽可能低延迟，尽可能减少对接口请求本身响应时间的影响
* 容错性
    * 不能因为幂等框架本身的异常，导致接口响应异常，影响服务本身的可用性
    * 比如，存储幂等号的外部存储器挂掉了，幂等逻辑无法正常运行，这个时候业务接口也要能正常服务才行